{% extends 'base.html' %}

{% block content %}
<h2>Edit Queue {{queue.title}}</h2>
<div>
    <h3>Owned by {{queue.owner.nickname}}</h3>
    <p>Created on {{queue.created_at}}</p>
    <h4>Description:</h4>
    <p>{{queue.description}}</p>
    <p><span id="queueLength">{{queue.length}}</span> entries</p>
    <p>
    </p>
</div>
<div class="owner-buttons">
    {% if is_owner %}

    <a href="{% url 'gain_access' queue.secret queue.owner.secret %}"><button>Share</button></a></h3>
    {% if not queue.published %}
    <a href="{% url 'publish' queue.id %}"><button>Publish</button></a>
    <p>Playlists are published by default as unlisted.</p>
    {% elif not queue.synced %}
    <a href="{% url 'sync' queue.id %}"><button>Sync</button></a>
    {%endif%}
    <a href="{% url 'delete_queue' queue.id %}"><button>Delete</button></a>
    {% endif %}
</div>
{% if queue.published %}
<div>
    <a href="{{queue.url}}"><button>Play on YouTube</button></a>
</div>
{% endif %}
<form id="searchForm" method="POST">
    {% csrf_token %}
    <span>
        <label for="searchQuery">Search:</label>
        <input type="text" id="searchQuery" name="searchQuery" value="{{recent_search}}">
    </span>
    <button id="searchButton" type="submit" class="btn btn-lg">Search</button>
</form>
<div>
    {% if queue.full %}
    <h4>The queue is full. Remove some tracks if you would like to add more. </h4>
    {% endif %}

    <ol>
        {% for entry in queue.all_entries %}
        <li>
            <div id="div-position-{{entry.position}}">
                <span>{{entry.title}} added by {{entry.user}} ({{entry.duration}})</span>
                {% if is_owner %}
                <a href="{% url 'delete_entry' queue_id=queue.id entry_id=entry.id %}"><button
                        class="btn btn-md">Remove</button></a>
                <div class="position-div">
                    <button data-queue="{{queue.id}}" data-entry="{{entry.id}}" class="move-btn position-btn"
                        data-position="{{entry.position|add:'-1'}}" data-direction="+">+</button>
                    <button data-queue="{{queue.id}}" data-entry="{{entry.id}}" class="move-btn position-btn"
                        data-position="{{entry.position|add:'1'}}" data-direction="-">-</button>
                    <label for="new-position-{{entry.id}}" id="label-{{entry.id}}">New Position:</label>
                    <input id="new-position-{{entry.id}}" type="number" class="swap-input">
                    <button type="submit" class="btn btn-md swap-button position-btn" data-queue="{{queue.id}}"
                        data-entry="{{entry.id}}">Swap</button>
                </div>
                {% endif %}
                </span>
            </div>
        </li>
        {% endfor %}
    </ol>
</div>
{% if not queue.full %}
<div>
    <h3>Search results for {{recent_search}}</h3>
    <ul>
        {% for result in search_results %}
        <li>
            {{result.title}}

            <a href="{% url 'add_entry' queue_id=queue.id video_id=result.id %}"><button
                    class="btn btn-md">Add</button></a>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% if not is_guest %}
<a href="{% url 'profile' %}">Back to Profile</a>
{%else%}
Special sign up for Guest user.
{% endif %}
{% endblock content %}